**Pattern**: Segmenting customers based on purchasing behavior.

**Decomposition Strategy**:

1. Calculate recency (days since last purchase)
2. Calculate frequency (count of purchases)
3. Calculate monetary value (total spending)
4. Assign scores or percentiles to each dimension
5. Combine into customer segments

**Example**: "Create an RFM segmentation for customers."

```SQL
WITH customer_metrics AS (
    SELECT
        customer_id,
        DATEDIFF(CURRENT_DATE, MAX(purchase_date)) AS recency,
        COUNT(DISTINCT order_id) AS frequency,
        SUM(amount) AS monetary
    FROM orders
    GROUP BY customer_id
),

rfm_scores AS (
    SELECT
        customer_id,
        recency,
        frequency,
        monetary,
        NTILE(5) OVER (ORDER BY recency DESC) AS r_score,
        NTILE(5) OVER (ORDER BY frequency) AS f_score,
        NTILE(5) OVER (ORDER BY monetary) AS m_score
    FROM customer_metrics
)

SELECT
    customer_id,
    CONCAT(r_score, f_score, m_score) AS rfm_segment
FROM rfm_scores;
```
