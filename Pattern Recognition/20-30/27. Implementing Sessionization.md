**Pattern**: Grouping user activities into sessions.

**Decomposition Strategy**:

1. Order activities chronologically
2. Identify session boundaries (e.g., 30-minute inactivity)
3. Assign session IDs
4. Aggregate metrics within sessions

**Example**: "Group user website activities into sessions with 30-minute inactivity timeout."

```SQL
WITH ordered_events AS (
    SELECT
        user_id,
        event_time,
        LAG(event_time) OVER (PARTITION BY user_id ORDER BY event_time) AS prev_event_time
    FROM user_events
),

session_boundaries AS (
    SELECT
        user_id,
        event_time,
        CASE
            WHEN prev_event_time IS NULL OR
                 TIMESTAMPDIFF(MINUTE, prev_event_time, event_time) > 30
            THEN 1
            ELSE 0
        END AS is_new_session
    FROM ordered_events
),

session_ids AS (
    SELECT
        user_id,
        event_time,
        SUM(is_new_session) OVER (PARTITION BY user_id ORDER BY event_time) AS session_id
    FROM session_boundaries
)

SELECT
    user_id,
    session_id,
    MIN(event_time) AS session_start,
    MAX(event_time) AS session_end,
    COUNT(*) AS event_count,
    TIMESTAMPDIFF(MINUTE, MIN(event_time), MAX(event_time)) AS session_duration_minutes
FROM session_ids
GROUP BY user_id, session_id;
```
