**Pattern**: Finding frequently co-occurring items in transactions.

**Decomposition Strategy**:

1. Identify all unique item pairs in each transaction
2. Count occurrences of each item individually
3. Count co-occurrences of item pairs
4. Calculate support, confidence, and lift metrics

**Example**: "Calculate product pairs with high lift ratios in shopping carts."

```SQL
WITH item_counts AS (
    -- Count occurrences of each individual item
    SELECT
        product_id,
        COUNT(DISTINCT order_id) AS product_frequency,
        COUNT(DISTINCT order_id) * 1.0 / (SELECT COUNT(DISTINCT order_id) FROM orders) AS support
    FROM order_items
    GROUP BY product_id
),

item_pairs AS (
    -- Generate all item pairs within each order
    SELECT
        a.order_id,
        a.product_id AS product_a,
        b.product_id AS product_b
    FROM order_items a
    JOIN order_items b ON a.order_id = b.order_id AND a.product_id < b.product_id
),

pair_metrics AS (
    -- Calculate support for each pair
    SELECT
        product_a,
        product_b,
        COUNT(DISTINCT order_id) AS pair_frequency,
        COUNT(DISTINCT order_id) * 1.0 / (SELECT COUNT(DISTINCT order_id) FROM orders) AS pair_support
    FROM item_pairs
    GROUP BY product_a, product_b
)

SELECT
    p.product_a,
    p.product_b,
    a.support AS support_a,
    b.support AS support_b,
    p.pair_support,
    p.pair_support / a.support AS confidence_a_b,
    p.pair_support / b.support AS confidence_b_a,
    p.pair_support / (a.support * b.support) AS lift
FROM pair_metrics p
JOIN item_counts a ON p.product_a = a.product_id
JOIN item_counts b ON p.product_b = b.product_id
WHERE p.pair_frequency >= 10  -- minimum frequency threshold
ORDER BY lift DESC;
```