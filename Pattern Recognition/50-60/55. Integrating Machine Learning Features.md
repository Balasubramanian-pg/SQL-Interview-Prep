**Pattern**: Preparing and incorporating ML features in SQL.

**Decomposition Strategy**:

1. Generate feature vectors from raw data
2. Normalize or standardize values
3. Apply dimension reduction techniques
4. Integrate with ML models

**Example**: "Create customer features for a recommendation model."

```SQL
-- Feature generation
WITH customer_features AS (
    -- Recency feature
    SELECT
        customer_id,
        DATEDIFF(DAY, MAX(order_date), CURRENT_DATE) AS days_since_last_order,
        COUNT(order_id) AS order_count,
        SUM(order_total) AS total_spent,
        AVG(order_total) AS avg_order_value,
        SUM(CASE WHEN returned = 1 THEN 1 ELSE 0 END) / COUNT(*) AS return_rate,
        COUNT(DISTINCT category_id) AS category_diversity
    FROM orders
    GROUP BY customer_id
),

-- Feature normalization
normalized_features AS (
    SELECT
        customer_id,
        (days_since_last_order - MIN(days_since_last_order) OVER ()) /
            (MAX(days_since_last_order) OVER () - MIN(days_since_last_order) OVER ()) AS norm_recency,
        (order_count - MIN(order_count) OVER ()) /
            (MAX(order_count) OVER () - MIN(order_count) OVER ()) AS norm_frequency,
        (total_spent - MIN(total_spent) OVER ()) /
            (MAX(total_spent) OVER () - MIN(total_spent) OVER ()) AS norm_monetary,
        return_rate,
        (category_diversity - MIN(category_diversity) OVER ()) /
            (MAX(category_diversity) OVER () - MIN(category_diversity) OVER ()) AS norm_diversity
    FROM customer_features
)

SELECT
    customer_id,
    norm_recency,
    norm_frequency,
    norm_monetary,
    return_rate,
    norm_diversity,
    -- Create cluster assignments based on feature similarity
    NTILE(5) OVER (ORDER BY norm_monetary * 0.5 + norm_frequency * 0.3 + (1 - norm_recency) * 0.2) AS value_segment,
    NTILE(4) OVER (ORDER BY return_rate) AS return_segment
FROM normalized_features;
```
