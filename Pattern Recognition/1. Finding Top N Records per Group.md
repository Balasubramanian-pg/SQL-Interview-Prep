**Pattern**: Identifying the highest/lowest N values within each category.

**Decomposition Strategy**:

1. Identify the groups and the metric to rank by
2. Apply window functions with PARTITION BY and ORDER BY
3. Filter by rank â‰¤ N

**Example**: "Find the top 3 highest-paid employees in each department."

```SQL
 WITH ranked_employees AS (
    SELECT
        name, department, salary,
        RANK() OVER (PARTITION BY department ORDER BY salary DESC) AS rank
    FROM employees
)
 SELECT name, department, salary
 FROM ranked_employees
 WHERE rank <= 3;
```
