**Pattern**: Calculating cumulative percentages of a distribution.

**Decomposition Strategy**:

1. Order values by the metric of interest
2. Calculate running count/sum
3. Divide by total count/sum to get percentages

**Example**: "Calculate what percentage of total revenue comes from the top X% of customers."

```SQL
WITH customer_revenue AS (
    SELECT
        customer_id,
        SUM(amount) AS total_spent,
        PERCENT_RANK() OVER (ORDER BY SUM(amount) DESC) AS percentile
    FROM orders
    GROUP BY customer_id
),

revenue_distribution AS (
    SELECT
        FLOOR(percentile * 10) * 10 AS percentile_bucket,
        SUM(total_spent) AS revenue
    FROM customer_revenue
    GROUP BY FLOOR(percentile * 10) * 10
),

running_totals AS (
    SELECT
        percentile_bucket,
        revenue,
        SUM(revenue) OVER (ORDER BY percentile_bucket) AS cumulative_revenue,
        SUM(revenue) OVER () AS total_revenue
    FROM revenue_distribution
)

SELECT
    percentile_bucket AS customer_percentile,
    revenue,
    cumulative_revenue,
    cumulative_revenue / total_revenue * 100 AS cumulative_percentage
FROM running_totals
ORDER BY customer_percentile;
```