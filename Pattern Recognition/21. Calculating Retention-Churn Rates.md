**Pattern**: Tracking user engagement over consecutive periods.

**Decomposition Strategy**:

1. Identify active users in current period
2. Identify active users in previous period
3. Calculate intersection and differences
4. Compute retention metrics

**Example**: "Calculate monthly user retention rates for a SaaS product."

```SQL
WITH monthly_active AS (
    SELECT
        user_id,
        DATE_TRUNC('month', activity_date) AS month
    FROM user_activities
    GROUP BY user_id, month
),

retention_data AS (
    SELECT
        curr.month,
        COUNT(DISTINCT curr.user_id) AS total_users,
        COUNT(DISTINCT prev.user_id) AS retained_users
    FROM monthly_active curr
    LEFT JOIN monthly_active prev
        ON curr.user_id = prev.user_id
        AND prev.month = DATE_ADD(curr.month, INTERVAL -1 MONTH)
    GROUP BY curr.month
)

SELECT
    month,
    total_users,
    retained_users,
    retained_users / total_users * 100 AS retention_rate
FROM retention_data
ORDER BY month;
```