**Pattern**: Identifying the most efficient resource distribution.

**Decomposition Strategy**:

1. Calculate resource utilization metrics
2. Rank resources by efficiency
3. Apply allocation priorities

**Example**: "Distribute inventory across warehouses to minimize shipping costs."

```SQL
WITH product_demand AS (
    SELECT
        region_id,
        product_id,
        SUM(quantity) AS demand
    FROM customer_orders
    GROUP BY region_id, product_id
),

warehouse_capacity AS (
    SELECT
        warehouse_id,
        region_id,
        available_capacity
    FROM warehouses
),

shipping_costs AS (
    SELECT
        w.warehouse_id,
        pd.region_id,
        pd.product_id,
        pd.demand,
        w.available_capacity,
        calculate_shipping_cost(w.region_id, pd.region_id) AS cost_per_unit
    FROM product_demand pd
    CROSS JOIN warehouse_capacity w
),

ranked_options AS (
    SELECT
        warehouse_id,
        region_id,
        product_id,
        demand,
        available_capacity,
        cost_per_unit,
        ROW_NUMBER() OVER (PARTITION BY product_id, region_id ORDER BY cost_per_unit) AS cost_rank
    FROM shipping_costs
)

SELECT
    warehouse_id,
    region_id,
    product_id,
    LEAST(demand, available_capacity) AS allocation_quantity,
    cost_per_unit,
    LEAST(demand, available_capacity) * cost_per_unit AS total_cost
FROM ranked_options
WHERE cost_rank = 1;
```
