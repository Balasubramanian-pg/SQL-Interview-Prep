**Pattern**: Reconstructing current state from event logs.

**Decomposition Strategy**:

1. Identify relevant event types
2. Order events chronologically
3. Apply events sequentially to build state
4. Handle special cases like deletions

**Example**: "Reconstruct current inventory levels from inventory events."

```SQL
WITH inventory_events AS (
    SELECT
        product_id,
        warehouse_id,
        event_time,
        event_type,
        quantity_change,
        ROW_NUMBER() OVER (
            PARTITION BY product_id, warehouse_id
            ORDER BY event_time, event_id
        ) AS event_sequence
    FROM inventory_events
),

initial_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        COALESCE(
            (SELECT starting_quantity
             FROM inventory_initialization
             WHERE product_id = ie.product_id AND warehouse_id = ie.warehouse_id),
            0
        ) AS quantity
    FROM inventory_events ie
    GROUP BY product_id, warehouse_id
),

inventory_state AS (
    SELECT
        e.product_id,
        e.warehouse_id,
        e.event_sequence,
        e.event_time,
        e.event_type,
        e.quantity_change,
        SUM(
            CASE
                WHEN e.event_sequence = 1 THEN i.quantity + e.quantity_change
                ELSE e.quantity_change
            END
        ) OVER (
            PARTITION BY e.product_id, e.warehouse_id
            ORDER BY e.event_sequence
            ROWS UNBOUNDED PRECEDING
        ) AS current_quantity
    FROM inventory_events e
    JOIN initial_inventory i ON e.product_id = i.product_id AND e.warehouse_id = i.warehouse_id
)

-- Current inventory (latest event for each product/warehouse)
SELECT
    product_id,
    warehouse_id,
    current_quantity
FROM (
    SELECT
        product_id,
        warehouse_id,
        current_quantity,
        ROW_NUMBER() OVER (
            PARTITION BY product_id, warehouse_id
            ORDER BY event_sequence DESC
        ) AS rn
    FROM inventory_state
) latest
WHERE rn = 1;
```