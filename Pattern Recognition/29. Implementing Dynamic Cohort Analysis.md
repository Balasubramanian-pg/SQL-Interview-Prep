**Pattern**: Tracking user behavior across time-based cohorts.

**Decomposition Strategy**:

1. Identify cohort assignment criteria (e.g., signup month)
2. Calculate retention for subsequent periods
3. Format results for cohort grid visualization

**Example**: "Create a monthly cohort retention analysis."

```SQL
WITH user_cohorts AS (
    -- Assign users to cohorts based on first order month
    SELECT
        user_id,
        DATE_TRUNC('month', MIN(order_date)) AS cohort_month
    FROM orders
    GROUP BY user_id
),

user_activity AS (
    -- Calculate months since first order for each activity
    SELECT
        o.user_id,
        uc.cohort_month,
        DATE_TRUNC('month', o.order_date) AS activity_month,
        DATEDIFF('month', uc.cohort_month, DATE_TRUNC('month', o.order_date)) AS month_number
    FROM orders o
    JOIN user_cohorts uc ON o.user_id = uc.user_id
),

cohort_size AS (
    -- Count users in each cohort
    SELECT
        cohort_month,
        COUNT(DISTINCT user_id) AS users
    FROM user_cohorts
    GROUP BY cohort_month
),

retention AS (
    -- Calculate retention for each cohort and month
    SELECT
        cohort_month,
        month_number,
        COUNT(DISTINCT user_id) AS active_users
    FROM user_activity
    GROUP BY cohort_month, month_number
)

SELECT
    r.cohort_month,
    cs.users AS cohort_size,
    r.month_number,
    r.active_users,
    r.active_users * 100.0 / cs.users AS retention_rate
FROM retention r
JOIN cohort_size cs ON r.cohort_month = cs.cohort_month
ORDER BY r.cohort_month, r.month_number;
```