# Percentage of Uncategorised Calls

## 1. Objective
> [!NOTE]
> This document explains how to write a SQL query to calculate the percentage of calls to the Advocate4Me call center that are considered "uncategorised". The final result will be rounded to one decimal place.

## 2. Data Model

### 2.1. `callers` Table
Contains a log of all calls made by policy holders.
| Column Name        | Type      |
|:-------------------|:----------|
| policy_holder_id   | integer   |
| case_id            | varchar   |
| call_category      | varchar   |
| call_date          | timestamp |
| call_duration_secs | integer   |

## 3. Core Logic: Identifying Uncategorised Calls
The key to this problem is correctly identifying all types of uncategorised calls. According to the problem description, a call is uncategorised if the `call_category` field is:
1.  `NULL` (the field was never filled in).
2.  `'n/a'` (the agent explicitly marked it as not applicable).
3.  An empty string `''` (the agent entered a blank value).

> [!TIP]
> It's crucial to handle all three conditions. `call_category IS NULL` is different from `call_category = ''`. A `NULL` value represents the absence of data, while an empty string is a type of string data.

## 4. Incremental Query Construction
The calculation can be performed in a single, efficient query using conditional aggregation. The formula for the percentage is:

`Percentage = 100.0 * (Count of Uncategorised Calls / Total Count of All Calls)`

### 4.1. Step 1: Count Uncategorised Calls Using `CASE`
We can count the uncategorised calls using a `SUM` function combined with a `CASE` statement. The `CASE` statement will act as a filter, returning `1` if a call is uncategorised and `0` otherwise. Summing these values gives us the total count of uncategorised calls.

```sql
SUM(
    CASE
        WHEN call_category IS NULL OR call_category = 'n/a' THEN 1
        ELSE 0
    END
)
```
> [!CAUTION]
> The original prompt also mentioned empty strings. While not present in the example, a robust solution should handle this. The full condition would be `WHEN call_category IS NULL OR call_category = 'n/a' OR call_category = '' THEN 1`.

### 4.2. Step 2: Count Total Calls
The total number of calls can be found simply by counting all rows in the table using `COUNT(*)`.

### 4.3. Step 3: Combine and Calculate the Percentage
We can now combine these two parts into the percentage formula.

> [!IMPORTANT]
> To avoid integer division (where `1 / 5` would result in `0`), we must multiply by a decimal value like `100.0`. This forces the database to perform floating-point arithmetic, preserving the decimal places needed for an accurate percentage.

```sql
100.0 *
SUM(CASE WHEN call_category IS NULL OR call_category = 'n/a' THEN 1 ELSE 0 END) /
COUNT(*)
```

### 4.4. Step 4: Round the Final Result
The final requirement is to round the result to one decimal place using the `ROUND()` function.

## 5. Final Solution
The complete query combines all steps into a single, efficient statement. It performs a single scan of the `callers` table.
```sql
SELECT
  -- Step 4: Round the final percentage to one decimal place.
  ROUND(
    -- Step 3: Multiply by 100.0 to get a percentage and ensure floating-point division.
    100.0 *
    -- Step 1: Sum up the uncategorised calls. The CASE statement returns 1 for each uncategorised call.
    SUM(
      CASE
        WHEN call_category IS NULL OR call_category = 'n/a' THEN 1
        ELSE 0
      END
    ) /
    -- Step 2: Count the total number of calls in the table.
    COUNT(*),
  1) AS uncategorised_call_pct
FROM callers;
```

## 6. Result Analysis

### 6.1. Final Output
| uncategorised_call_pct |
|:-----------------------|
| 20.0                   |

### 6.2. Explanation
*   The `SUM(...)` part of the query scans the 5 rows in the example data. It finds one row where `call_category` is `'n/a'` and evaluates to `1`. All other rows evaluate to `0`. The total sum is `1`.
*   The `COUNT(*)` part counts all 5 rows.
*   The calculation becomes `ROUND(100.0 * 1 / 5, 1)`, which is `ROUND(20.0, 1)`.
*   The final result is `20.0`.
