## Pattern 4: Consecutive Events

**Find Consecutive Days with Activity:**
```sql
-- Using LAG to compare adjacent rows
WITH flagged AS (
    SELECT 
        user_id,
        activity_date,
        LAG(activity_date) OVER(PARTITION BY user_id ORDER BY activity_date) as prev_date
    FROM user_activity
)
SELECT 
    user_id,
    activity_date,
    CASE 
        WHEN activity_date = prev_date + INTERVAL 1 DAY THEN 'Consecutive'
        ELSE 'Gap'
    END as streak_status
FROM flagged
```

**Count Consecutive Streak Length:**
```sql
-- Identify groups of consecutive dates
WITH groups AS (
    SELECT 
        user_id,
        activity_date,
        activity_date - ROW_NUMBER() OVER(PARTITION BY user_id ORDER BY activity_date) as grp
    FROM user_activity
)
SELECT 
    user_id,
    MIN(activity_date) as streak_start,
    MAX(activity_date) as streak_end,
    COUNT(*) as streak_length
FROM groups
GROUP BY user_id, grp
```

**Interview Gold:** The `date - ROW_NUMBER()` trick creates constant values for consecutive sequences!


3. **"I'd use NOT EXISTS instead of NOT IN here to avoid the NULL trap"** (shows edge case awareness)
