## Pattern 3: Finding Gaps in Sequences

**Missing IDs in Sequence:**
```sql
-- Method 1: Self-join (classic)
SELECT t1.id + 1 as missing_id
FROM orders t1
LEFT JOIN orders t2 ON t2.id = t1.id + 1
WHERE t2.id IS NULL
  AND t1.id < (SELECT MAX(id) FROM orders)

-- Method 2: NOT EXISTS (cleaner)
SELECT t1.id + 1 as gap_start
FROM orders t1
WHERE NOT EXISTS (
    SELECT 1 FROM orders t2 WHERE t2.id = t1.id + 1
)
AND t1.id < (SELECT MAX(id) FROM orders)

-- Method 3: Window function (modern)
SELECT id + 1 as gap_start,
       LEAD(id) OVER(ORDER BY id) - 1 as gap_end
FROM orders
WHERE LEAD(id) OVER(ORDER BY id) - id > 1
```

**Missing Dates in Date Range:**
```sql
-- Generate all dates and find missing ones
WITH RECURSIVE date_range AS (
    SELECT MIN(order_date) as dt FROM orders
    UNION ALL
    SELECT dt + INTERVAL 1 DAY
    FROM date_range
    WHERE dt < (SELECT MAX(order_date) FROM orders)
)
SELECT dr.dt as missing_date
FROM date_range dr
LEFT JOIN orders o ON o.order_date = dr.dt
WHERE o.order_date IS NULL
```


4. **"LAST_VALUE needs UNBOUNDED FOLLOWING in the frame, or it only sees up to current row"** (shows window function depth)
