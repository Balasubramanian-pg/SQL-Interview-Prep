To find at least `N` consecutive dates in a dataset (e.g., sales data), we can use **window functions** and **Common Table Expressions (CTEs)**.

## **Step 1: Generate a Grouping Identifier**

We subtract the **row number** from the `order_date` to create a **grouping column (**`**col1**`**)**, ensuring consecutive dates have the same identifier.

```SQL
SELECT order_date,
       DATEADD(DAY, -ROW_NUMBER() OVER (ORDER BY order_date), order_date) AS col1
FROM superstore_orders;
```

### **How It Works**

- `ROW_NUMBER() OVER (ORDER BY order_date)`: Assigns sequential numbers to rows based on date order.
- `DATEADD(DAY, -ROW_NUMBER(), order_date)`: Aligns consecutive dates to the same "base" date.

---

## **Step 2: Find Consecutive Date Ranges**

Now, we use a **CTE** to group records by the calculated `col1` and find `MIN` and `MAX` dates.

```SQL
WITH cte AS (
    SELECT order_date,
           DATEADD(DAY, -ROW_NUMBER() OVER (ORDER BY order_date), order_date) AS col1
    FROM superstore_orders
)
SELECT COUNT(*) AS cnt, MIN(order_date) AS startdate, MAX(order_date) AS enddate
FROM cte
GROUP BY col1;
```

### **What Happens Here?**

- The `GROUP BY col1` ensures consecutive records are grouped together.
- We count the number of dates in each group.
- `MIN(order_date)` and `MAX(order_date)` define the range of consecutive days.

---

## **Step 3: Filter for at Least** `**N**` **Consecutive Days**

To find records where there are at least **3 consecutive dates**, we use a `HAVING` clause.

```SQL
WITH cte AS (
    SELECT order_date,
           DATEADD(DAY, -ROW_NUMBER() OVER (ORDER BY order_date), order_date) AS col1
    FROM superstore_orders
)
SELECT startdate, enddate
FROM (
    SELECT COUNT(*) AS cnt, MIN(order_date) AS startdate, MAX(order_date) AS enddate
    FROM cte
    GROUP BY col1
) AS tbl
WHERE cnt >= 3;
```

### **Explanation:**

- The inner query groups the records by `col1`, identifying date sequences.
- The outer query filters groups where `cnt >= 3`, meaning at least **3 consecutive records** exist.

---

## **Performance Considerations**

- **Indexes:** Ensure `order_date` is indexed for efficiency.
- **Handling Missing Dates:** If dates have gaps, this method accurately detects only true consecutive sequences.
- **Adapting for More Days:** Change `WHERE cnt >= N` to find different lengths of consecutive records.
