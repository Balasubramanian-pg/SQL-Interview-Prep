## Problem Statement

Calculate the fraction of users who accessed Amazon Music and upgraded to Prime membership within the first 30 days of signing up, rounded to two decimal places.

## Tables

1. **userss** table:
    - `user_id`: Unique user identifier
    - `name`: User's name
    - `join_date`: Date when user joined
2. **events** table:
    - `user_id`: User identifier
    - `type`: Event type ('Music' for Amazon Music access, 'P' for Prime purchase)
    - `access_date`: Date of the event

## Solution Approach

### Step 1: Identify Users Who Accessed Amazon Music

```SQL
SELECT * FROM userss
WHERE user_id IN (SELECT user_id FROM events WHERE type='Music');
```

This finds all users who have at least one 'Music' type event.

### Step 2: Find Prime Purchases Within 30 Days

```SQL
SELECT u.*, e.type, e.access_date
FROM userss u
LEFT JOIN events e ON u.user_id = e.user_id AND e.type = 'P'
WHERE u.user_id IN (SELECT user_id FROM events WHERE type='Music');
```

This joins users with their Prime purchase events (if any), filtering only users who accessed Music.

### Step 3: Calculate Days Between Join and Prime Purchase

```SQL
SELECT u.*, e.type, e.access_date,
       DATEDIFF(day, u.join_date, e.access_date) AS no_of_days
FROM userss u
LEFT JOIN events e ON u.user_id = e.user_id AND e.type = 'P'
WHERE u.user_id IN (SELECT user_id FROM events WHERE type='Music');
```

Adds a column showing how many days after joining each user purchased Prime.

### Step 4: Calculate Conversion Rate

```SQL
SELECT
    COUNT(DISTINCT u.user_id) AS total_users,
    COUNT(DISTINCT CASE WHEN DATEDIFF(day, u.join_date, e.access_date) <= 30
                        THEN user_id END) AS converted_users,
    ROUND(1.0 * COUNT(DISTINCT CASE WHEN DATEDIFF(day, u.join_date, e.access_date) <= 30
                                   THEN user_id END) /
          COUNT(DISTINCT u.user_id), 2) AS conversion_rate
FROM userss u
LEFT JOIN events e ON u.user_id = e.user_id AND e.type = 'P'
WHERE u.user_id IN (SELECT user_id FROM events WHERE type='Music');
```

## Key Learning Points

1. **Subquery Filtering**: Using `IN` with a subquery to filter users based on their events.
2. **LEFT JOIN with Conditions**: Joining tables with additional conditions beyond just the key match.
3. **Date Difference Calculation**: Using `DATEDIFF` to calculate days between two dates.
4. **Conditional Counting**: Using `CASE WHEN` inside `COUNT` to count only specific rows.
5. **Conversion Rate Calculation**: Calculating a ratio and rounding to 2 decimal places.
6. **Handling NULLs**: The LEFT JOIN ensures we include users who didn't convert, counting them properly in the denominator.

## Final Answer

The query calculates the percentage of Amazon Music users who upgraded to Prime within 30 days of joining. The result is rounded to two decimal places.
