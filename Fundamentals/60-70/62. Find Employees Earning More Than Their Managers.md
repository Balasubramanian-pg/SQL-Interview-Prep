Here's a comprehensive solution to identify employees whose salary exceeds their manager's salary:

## Method 1: Using Self-Join (Recommended)

```SQL
SELECT
    e.emp_id,
    e.emp_name AS employee_name,
    e.department_id,
    e.salary AS employee_salary,
    m.emp_id AS manager_id,
    m.emp_name AS manager_name,
    m.salary AS manager_salary
FROM empm e
JOIN empm m ON e.manager_id = m.emp_id
WHERE e.salary > m.salary
ORDER BY e.department_id, e.salary DESC;
```

## Method 2: Using Subquery (Alternative Approach)

```SQL
SELECT
    emp_id,
    emp_name,
    department_id,
    salary
FROM empm e
WHERE salary > (
    SELECT salary
    FROM empm
    WHERE emp_id = e.manager_id
)
ORDER BY department_id, salary DESC;
```

## Method 3: With Additional Manager Details

```SQL
WITH manager_salaries AS (
    SELECT
        emp_id,
        emp_name,
        salary
    FROM empm
)
SELECT
    e.emp_id,
    e.emp_name AS employee_name,
    e.department_id,
    e.salary AS employee_salary,
    m.emp_id AS manager_id,
    m.emp_name AS manager_name,
    m.salary AS manager_salary,
    e.salary - m.salary AS salary_difference
FROM empm e
JOIN manager_salaries m ON e.manager_id = m.emp_id
WHERE e.salary > m.salary
ORDER BY salary_difference DESC;
```

## Key Features:

1. **Clear Comparison**:
    - Directly compares employee salary with their manager's salary
    - Shows both employee and manager details side-by-side
2. **Performance**:
    - The self-join approach (Method 1) is typically most efficient
    - Proper indexing on `emp_id` and `manager_id` improves performance
3. **Additional Insights**:
    - Calculates the exact salary difference (Method 3)
    - Sorts results by the largest salary differences (Method 3)
4. **Edge Case Handling**:
    - Automatically excludes employees without managers (NULL manager_id)
    - Clearly identifies the management chain

## Expected Output:

|   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|
|emp_id|employee_name|department_id|employee_salary|manager_id|manager_name|manager_salary|salary_difference|
|2|John Smith|101|85000|1|Jane Doe|75000|10000|
|5|Mike Brown|102|92000|3|Sarah Lee|90000|2000|

This query helps HR identify compensation anomalies where subordinates earn more than their managers, which can be useful for:

- Compensation reviews
- Organizational structure analysis
- Talent retention strategies
