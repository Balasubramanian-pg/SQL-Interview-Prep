---
Functions: Theory
---
## Understanding Ranking Functions

These window functions help you analyze data by assigning ranks to rows based on specified criteria.

### 1. Basic Ranking Functions

```SQL
USE world;

-- RANK: Same salary gets same rank, skips subsequent numbers
SELECT
    emp_id,
    emp_name,
    department_id,
    salary,
    RANK() OVER(ORDER BY salary DESC) AS rnk
FROM emp;
```

### 2. Comparing RANK and DENSE_RANK

```SQL
SELECT
    emp_id,
    emp_name,
    department_id,
    salary,
    RANK() OVER(ORDER BY salary DESC) AS rnk,
    DENSE_RANK() OVER(ORDER BY salary DESC) AS dens_rnk
FROM emp;
```

Key difference:

- RANK skips numbers after ties (e.g., 1, 2, 2, 4)
- DENSE_RANK doesn't skip numbers (e.g., 1, 2, 2, 3)

### 3. Adding ROW_NUMBER

```SQL
SELECT
    emp_id,
    emp_name,
    department_id,
    salary,
    RANK() OVER(ORDER BY salary DESC) AS rnk,
    DENSE_RANK() OVER(ORDER BY salary DESC) AS dens_rnk,
    ROW_NUMBER() OVER(ORDER BY salary DESC) AS rows_number
FROM emp;
```

ROW_NUMBER always assigns unique sequential numbers, even for ties.

### 4. Department-wise Ranking (PARTITION BY)

```SQL
SELECT
    emp_id,
    emp_name,
    department_id,
    salary,
    RANK() OVER(PARTITION BY department_id ORDER BY salary DESC) AS dept_rnk,
    DENSE_RANK() OVER(PARTITION BY department_id ORDER BY salary DESC) AS dept_dens_rnk,
    ROW_NUMBER() OVER(PARTITION BY department_id ORDER BY salary DESC) AS dept_row_num
FROM emp;
```

### 5. Finding Department-wise Highest Salary

```SQL
SELECT * FROM (
    SELECT
        emp_id,
        emp_name,
        department_id,
        salary,
        RANK() OVER(PARTITION BY department_id ORDER BY salary DESC) AS rnk
    FROM emp
) a
WHERE rnk = 1;
```

## Sample Data Structure

```SQL
CREATE TABLE emp (
    emp_id INT,
    emp_name VARCHAR(20),
    department_id VARCHAR(20),
    salary INT
);

INSERT INTO emp VALUES(1,'Ankit',100,10000);
INSERT INTO emp VALUES(2,'Mohit',100,15000);
INSERT INTO emp VALUES(3,'Vikas',100,10000);
INSERT INTO emp VALUES(4,'Rohit',100,5000);
INSERT INTO emp VALUES(5,'Mudit',200,12000);
INSERT INTO emp VALUES(6,'Agam',200,12000);
INSERT INTO emp VALUES(7,'Sanjay',200,9000);
INSERT INTO emp VALUES(8,'Ashish',200,5000);
```

## Expected Results Explanation

1. **Simple RANK**: Employees with same salary get same rank, next rank skips numbers
2. **DENSE_RANK**: Employees with same salary get same rank, but no numbers are skipped
3. **ROW_NUMBER**: Every row gets unique number, even if salaries are identical
4. **Partitioned Ranking**: Rankings restart for each department
5. **Top Earners**: Subquery filters to only show top-ranked (highest paid) in each department