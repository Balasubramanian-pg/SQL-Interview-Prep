---
Functions: Theory
---
## SQL Command Categories

- **DDL** (Data Definition Language): DROP, RENAME, CREATE, ALTER, TRUNCATE
- **DML** (Data Manipulation Language): DELETE, INSERT, UPDATE
- **DCL** (Data Control Language): GRANT, REVOKE
- **DQL** (Data Query Language): SELECT
- **TCL** (Transaction Control Language): COMMIT, ROLLBACK, SAVEPOINT

## Key Differences

### 1. DELETE vs TRUNCATE vs DROP

|Feature|DELETE|TRUNCATE|DROP|
|---|---|---|---|
|Type|DML|DDL|DDL|
|Removes|Some or all rows|All rows|Entire table|
|Space freed|No|Yes|Yes|
|Speed|Slower|Faster|Fastest|
|Where clause|Can use WHERE|No WHERE clause|N/A|
|Rollback|Can be rolled back|Cannot be rolled back|Cannot be rolled back|

### 2. WHERE vs HAVING

|Feature|WHERE|HAVING|
|---|---|---|
|Purpose|Filters rows|Filters aggregated data|
|Works with|Row data|Grouped/aggregated data|
|Usage|Before GROUP BY|After GROUP BY|
|Example|`SELECT * FROM emp WHERE score>40`|`SELECT dept, AVG(salary) FROM emp GROUP BY dept HAVING AVG(salary)>50000`|

### 3. GROUP BY vs ORDER BY

|Feature|GROUP BY|ORDER BY|
|---|---|---|
|Purpose|Groups rows for aggregation|Sorts results|
|Used with|Aggregate functions|Any SELECT statement|
|Position|Before HAVING|Last clause in query|
|Example|`SELECT dept, COUNT(*) FROM emp GROUP BY dept`|`SELECT * FROM emp ORDER BY salary DESC`|

### 4. CHAR vs VARCHAR

|Feature|CHAR|VARCHAR|
|---|---|---|
|Storage|Fixed length|Variable length|
|Speed|Faster|Slower|
|Memory|Static allocation|Dynamic allocation|
|Overhead|None|2 bytes|
|Best for|Fixed-length data (zip codes)|Variable-length data (names)|

### 5. UNION vs UNION ALL

|Feature|UNION|UNION ALL|
|---|---|---|
|Duplicates|Removes duplicates|Keeps duplicates|
|Performance|Slower (needs duplicate check)|Faster|
|Syntax|Requires same columns/order|Same requirements|

### 6. IN vs EXISTS

|Feature|IN|EXISTS|
|---|---|---|
|Purpose|Value comparison|Checks for row existence|
|Performance|Better for big outer/small inner|Better for small outer/big inner|
|Returns|True if value matches any|True if subquery returns rows|
|Example|`SELECT * FROM customers WHERE city IN ('Mumbai','Delhi')`|`SELECT * FROM customers c WHERE EXISTS (SELECT 1 FROM orders o WHERE o.cust_id=c.id)`|

### 7. JOIN vs SUBQUERY

|Feature|JOIN|SUBQUERY|
|---|---|---|
|Performance|Generally faster|Often slower|
|Flexibility|Can select from any joined table|Limited to outer query columns|
|Readability|Can be more readable|Can be more intuitive|

### 8. JOIN vs UNION

|Feature|JOIN|UNION|
|---|---|---|
|Operation|Combines columns horizontally|Combines rows vertically|
|Requirements|Needs related columns|Needs matching column structure|
|Result|Wider result (more columns)|Taller result (more rows)|

## Advanced Concepts

### Creating Empty Table with Same Structure

```SQL
SELECT * INTO students_copy FROM students WHERE 1=2;
```

### Pattern Matching in SQL

Uses LIKE operator with wildcards:

- `_` : Single character
- `%` : Any number of characters

```SQL
SELECT * FROM students WHERE name LIKE '_k%';  -- Second letter is 'k'
```

### Set Operations

- **UNION**: Combines results, removes duplicates
- **INTERSECT**: Returns only common records
- **MINUS**: Returns records in first table not in second

```SQL
SELECT name FROM students UNION SELECT name FROM contacts;
```

### Views

Virtual tables based on SQL queries:

```SQL
CREATE VIEW india_customers AS
SELECT * FROM customers WHERE country='India';
```

### Character Manipulation Functions

- `UPPER()`: Converts to uppercase
- `LOWER()`: Converts to lowercase
- `INITCAP()`: Capitalizes first letter of each word
- `LENGTH()`: Returns string length
- `CONCAT()`: Joins strings together

### Deleting Duplicate Rows

1. **Using Temporary Table**:
    
    ```SQL
    SELECT DISTINCT * INTO new_table FROM old_table;
    DELETE FROM old_table;
    INSERT INTO old_table SELECT * FROM new_table;
    DROP TABLE new_table;
    ```
    
2. **Using Auto ID**:
    
    ```SQL
    ALTER TABLE employee ADD auto_id INT IDENTITY(1,1);
    DELETE FROM employee WHERE auto_id NOT IN (
      SELECT MIN(auto_id) FROM employee GROUP BY emp_id, emp_name
    );
    ```
    
3. **Using ROW_NUMBER()**:
    
    ```SQL
    DELETE FROM (
      SELECT ROW_NUMBER() OVER(PARTITION BY id ORDER BY id) AS rn
      FROM mytable
    ) WHERE rn > 1;
    ```
    
4. **Using CTE**:
    
    ```SQL
    WITH cte AS (
      SELECT ROW_NUMBER() OVER(PARTITION BY id ORDER BY id) AS rn
      FROM mytable
    )
    DELETE FROM cte WHERE rn > 1;
    ```