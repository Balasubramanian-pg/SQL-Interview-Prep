## Understanding Mode

The **mode** is the value that appears most frequently in a dataset. Unlike mean (average) and median (middle value), SQL doesn't have a built-in mode function, so we need creative solutions.

## Method 1: Using Common Table Expression (CTE) with COUNT

```SQL
WITH freq_cte AS (
    SELECT
        id,
        COUNT(*) AS frequency
    FROM mode
    GROUP BY id
)
SELECT id
FROM freq_cte
WHERE frequency = (SELECT MAX(frequency) FROM freq_cte);
```

**How it works**:

1. First CTE counts occurrences of each value
2. Outer query selects values with the maximum frequency
3. Handles multiple modes (when several values share the highest frequency)

## Method 2: Using RANK() Function

```SQL
WITH freq_cte AS (
    SELECT
        id,
        COUNT(*) AS frequency
    FROM mode
    GROUP BY id
),
rnk_cte AS (
    SELECT
        *,
        RANK() OVER(ORDER BY frequency DESC) AS rnk
    FROM freq_cte
)
SELECT id
FROM rnk_cte
WHERE rnk = 1;
```

**Advantages**:

- More flexible for additional analysis
- Easier to extend (e.g., get top 3 most frequent values)
- Clearly shows the ranking of all values

## Handling Edge Cases

### When all values are unique:

```SQL
-- Returns all values since each appears once
SELECT id FROM mode
GROUP BY id
HAVING COUNT(*) = (
    SELECT MAX(cnt) FROM (
        SELECT COUNT(*) AS cnt FROM mode GROUP BY id
    ) t
);
```

### When there's a tie for mode:

Both methods will return all values that share the highest frequency.

## Performance Considerations

1. For small tables: Both methods work equally well
2. For large tables:
    - The COUNT method is generally faster
    - Consider adding indexes on the column if calculating mode frequently

## Alternative Approach (Single Query)

```SQL
SELECT id
FROM mode
GROUP BY id
HAVING COUNT(*) = (
    SELECT COUNT(*) AS freq
    FROM mode
    GROUP BY id
    ORDER BY freq DESC
    LIMIT 1
);
```

**Note**: Uses LIMIT which works in MySQL/PostgreSQL. For SQL Server, use TOP 1 instead.
