## Problem Analysis

We need to identify which quarters are missing for each store in the sales data. Each store should have data for all 4 quarters (Q1-Q4).

## Method 1: Mathematical Aggregation

```SQL
SELECT
    Store,
    'Q' + CAST(10 - SUM(CAST(RIGHT(Quarter, 1) AS INT)) AS CHAR(1)) AS missing_quarter
FROM STORES
GROUP BY Store
HAVING COUNT(*) < 4;
```

**How it works**:

- Sums the quarter numbers (1+2+3+4=10)
- Subtracts the sum of existing quarters from 10
- The result identifies the missing quarter number
- Only returns stores with missing quarters (HAVING COUNT(*) < 4)

## Method 2: Recursive CTE

```SQL
WITH all_quarters AS (
    SELECT DISTINCT Store, 1 AS q_no FROM STORES
    UNION ALL
    SELECT Store, q_no + 1 FROM all_quarters
    WHERE q_no < 4
),
quarter_labels AS (
    SELECT Store, 'Q' + CAST(q_no AS CHAR(1)) AS quarter
    FROM all_quarters
)
SELECT
    q.Store,
    q.quarter AS missing_quarter
FROM quarter_labels q
LEFT JOIN STORES s ON q.Store = s.Store AND q.quarter = s.Quarter
WHERE s.Store IS NULL
ORDER BY q.Store, q.quarter;
```

**How it works**:

1. Generates all possible quarter numbers (1-4) for each store
2. Converts numbers to quarter labels (Q1-Q4)
3. Left joins with original data to find missing combinations

## Method 3: CROSS JOIN Approach

```SQL
WITH all_combinations AS (
    SELECT DISTINCT s1.Store, s2.Quarter
    FROM (SELECT DISTINCT Store FROM STORES) s1
    CROSS JOIN (SELECT DISTINCT Quarter FROM STORES) s2
)
SELECT
    c.Store,
    c.Quarter AS missing_quarter
FROM all_combinations c
LEFT JOIN STORES s ON c.Store = s.Store AND c.Quarter = s.Quarter
WHERE s.Store IS NULL
ORDER BY c.Store, c.Quarter;
```

**How it works**:

1. Creates all possible store-quarter combinations
2. Left joins with original data to find missing entries
3. More flexible than Method 1 (works even if multiple quarters are missing)

## Comparison of Methods

|   |   |   |
|---|---|---|
|Method|Pros|Cons|
|1 (Math)|Simplest solution|Only works when exactly 1 quarter is missing|
|2 (Recursive)|Handles multiple missing quarters|More complex syntax|
|3 (CROSS JOIN)|Most flexible, clean logic|Requires generating all combinations|

## Expected Output

For the given data:

```Plain
Store | missing_quarter
------+---------------
S1    | Q3
S2    | Q2
S3    | Q4
```

## Recommendation

**Use Method 3 (CROSS JOIN)** for most cases because:

- It clearly shows all missing quarters
- Works regardless of how many quarters are missing
- Easy to understand and maintain
- Doesn't rely on mathematical tricks
