## Problem Analysis

We need to calculate total charges for each employee based on:

1. Their billing rate during specific date ranges
2. Hours worked on specific dates

## Solution Approach

### Step 1: Establish Billing Date Ranges

```SQL
WITH DATE_RANGE AS (
    SELECT *,
    LEAD(DATEADD(DAY,-1,BILL_DATE),1,'9999-12-31')
        OVER(PARTITION BY EMP_NAME ORDER BY BILL_DATE ASC) AS BILL_DATE_END
    FROM BILLINGS
)
```

- Uses `LEAD()` to find the next billing date for each employee
- Subtracts 1 day to create proper date ranges (inclusive)
- Uses '9999-12-31' as default end date for current rate

### Step 2: Join with Hours Worked

```SQL
SELECT
    HW.EMP_NAME,
    SUM(DR.BILL_RATE * HW.BILL_HRS) AS TOTAL_CHARGES
FROM DATE_RANGE DR
INNER JOIN HoursWorked HW
    ON DR.EMP_NAME = HW.EMP_NAME
    AND HW.WORK_DATE BETWEEN DR.BILL_DATE AND DR.BILL_DATE_END
GROUP BY HW.EMP_NAME;
```

## How This Works

1. **Date Range Calculation**:
    - For Sachin:
        - First rate (25): 1990-01-01 to 1991-02-04
        - Second rate (30): 1991-02-05 onwards
    - For Sehwag and Dhoni: Single rate covering all dates
2. **Hour Matching**:
    - Sachin's hours on 1990-07-01 and 1990-08-01 use $25 rate
    - Sachin's hours on 1991-07-01 use $30 rate
    - Sehwag's hours use $15 rate
3. **Calculation**:
    - Sachin: (25×3 + 25×5 + 30×4) = 75 + 125 + 120 = 320
    - Sehwag: 15×2 = 30
    - Dhoni: No hours worked (not in result)

## Verification

```SQL
SELECT 25*8 + 30*4; -- Sachin's calculation (320)
SELECT 15*2;        -- Sehwag's calculation (30)
```

## Final Output

```Plain
EMP_NAME | TOTAL_CHARGES
---------+--------------
Sachin   | 320
Sehwag   | 30
```

## Key Learnings

1. **LEAD() Function**: Essential for creating date ranges
2. **Date Handling**: Using DATEADD to properly define ranges
3. **BETWEEN Operator**: Correctly matches hours to billing periods
4. **Aggregation**: SUM with GROUP BY calculates totals per employee

## Alternative Approach

For databases without LEAD():

```SQL
WITH RATES AS (
    SELECT
        b1.EMP_NAME,
        b1.BILL_DATE AS START_DATE,
        COALESCE(
            (SELECT MIN(b2.BILL_DATE)
            FROM BILLINGS b2
            WHERE b2.EMP_NAME = b1.EMP_NAME AND b2.BILL_DATE > b1.BILL_DATE),
            '9999-12-31') AS END_DATE,
        b1.BILL_RATE
    FROM BILLINGS b1
)
SELECT
    HW.EMP_NAME,
    SUM(R.BILL_RATE * HW.BILL_HRS) AS TOTAL_CHARGES
FROM RATES R
JOIN HoursWorked HW
    ON R.EMP_NAME = HW.EMP_NAME
    AND HW.WORK_DATE >= R.START_DATE
    AND (HW.WORK_DATE < R.END_DATE OR R.END_DATE = '9999-12-31')
GROUP BY HW.EMP_NAME;
```