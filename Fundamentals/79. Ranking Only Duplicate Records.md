## Problem Statement

We need to identify duplicate records in a table and assign them ranking labels, while leaving unique records with NULL values.

## Solution Approach

### Method 1: Using Common Table Expressions (CTEs)

```SQL
WITH cte_dupl AS (
    SELECT id
    FROM list
    GROUP BY id
    HAVING COUNT(1) > 1
),
cte_rank AS (
    SELECT *,
    RANK() OVER(ORDER BY id ASC) AS rn
    FROM cte_dupl
)
SELECT
    l.*,
    'DUP' + CAST(cr.rn AS CHAR(2)) AS output
FROM list l
LEFT JOIN cte_rank cr ON l.id = cr.id;
```

### Method 2: Using CONCAT (More Standard SQL)

```SQL
WITH cte_dupl AS (
    SELECT id
    FROM list
    GROUP BY id
    HAVING COUNT(1) > 1
),
cte_rank AS (
    SELECT *,
    RANK() OVER(ORDER BY id ASC) AS rn
    FROM cte_dupl
)
SELECT
    l.*,
    CONCAT('DUP', CAST(cr.rn AS CHAR(5))) AS output
FROM list l
LEFT JOIN cte_rank cr ON l.id = cr.id;
```

## How This Works

1. **First CTE (cte_dupl)**:
    - Identifies duplicate values by grouping and counting
    - `HAVING COUNT(1) > 1` filters only duplicate IDs
2. **Second CTE (cte_rank)**:
    - Assigns ranks to the duplicate IDs in ascending order
    - Uses `RANK()` window function
3. **Final Query**:
    - Joins the original table with the ranked duplicates
    - Uses LEFT JOIN to preserve all original records
    - For duplicates: creates labels like "DUP1", "DUP2"
    - For unique values: shows NULL (since they don't exist in cte_rank)

## Expected Output

For the sample data:

```Plain
id | output
---+-------
a  | DUP1
a  | DUP1
b  | NULL
c  | DUP2
c  | DUP2
c  | DUP2
d  | DUP3
d  | DUP3
e  | NULL
```

## Key Features

1. **Duplicate Identification**: Using GROUP BY and HAVING
2. **Ranking**: Assigns sequential numbers to duplicates
3. **Labeling**: Formats output with "DUP" prefix
4. **NULL Handling**: Preserves unique records with NULL values

## Alternative Approach (Single Query)

```SQL
SELECT
    id,
    CASE
        WHEN COUNT(*) OVER(PARTITION BY id) > 1
        THEN 'DUP' || DENSE_RANK() OVER(ORDER BY MIN(id) OVER(PARTITION BY id))
        ELSE NULL
    END AS output
FROM list;
```

This approach uses window functions exclusively without CTEs, making it more concise.