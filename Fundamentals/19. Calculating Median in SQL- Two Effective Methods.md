## Understanding Median

Median is the middle value in an ordered dataset:

- **Odd count**: Middle value (e.g., 1,3,5 → median is 3)
- **Even count**: Average of two middle values (e.g., 1,3,5,7 → median is (3+5)/2 = 4)

## Method 1: Using ROW_NUMBER (Works in All Databases)

```SQL
WITH ranked_ages AS (
    SELECT *,
        ROW_NUMBER() OVER (ORDER BY emp_age ASC) AS rn_asc,
        ROW_NUMBER() OVER (ORDER BY emp_age DESC) AS rn_desc
    FROM empl
    -- WHERE emp_id < 10  -- Optional filter
)
SELECT AVG(emp_age) AS median_age
FROM ranked_ages
WHERE ABS(rn_asc - rn_desc) <= 1;
```

**How it works**:

1. Creates ascending and descending row numbers
2. For odd counts: Finds the single row where rn_asc = rn_desc
3. For even counts: Finds two rows where rn_asc and rn_diff differ by 1
4. Averages these values to get the median

## Method 2: Using PERCENTILE_CONT (SQL Server Specific)

### Overall Median:

```SQL
SELECT
    PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY emp_age) OVER() AS median_age
FROM empl
WHERE emp_id < 10
LIMIT 1;  -- Returns just one row with the median
```

### Department-wise Medians:

```SQL
SELECT DISTINCT
    department_id,
    PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY emp_age)
        OVER(PARTITION BY department_id) AS dept_median_age
FROM empl;
```

**Key advantages**:

- More concise syntax
- Built specifically for percentile calculations
- Handles both odd and even counts automatically

## Sample Data for Reference

```SQL
CREATE TABLE empl (
    emp_id INT,
    emp_name VARCHAR(20),
    department_id VARCHAR(20),
    salary INT,
    manager_id INT,
    emp_age INT
);

INSERT INTO empl VALUES(1,'Ankit',100,10000,4,39);
INSERT INTO empl VALUES(2,'Mohit',100,15000,5,48);
INSERT INTO empl VALUES(3,'Vikas',100,10000,4,37);
INSERT INTO empl VALUES(4,'Rohit',100,5000,2,16);
INSERT INTO empl VALUES(5,'Mudit',200,12000,6,55);
INSERT INTO empl VALUES(6,'Agam',200,12000,2,14);
INSERT INTO empl VALUES(7,'Sanjay',200,9000,2,13);
INSERT INTO empl VALUES(8,'Ashish',200,5000,2,12);
INSERT INTO empl VALUES(9,'Mukesh',300,6000,6,51);
INSERT INTO empl VALUES(10,'Rakesh',300,7000,6,50);
```

## When to Use Each Method

1. **ROW_NUMBER approach**:
    - When working with databases that don't support PERCENTILE_CONT
    - When you need to understand the underlying calculation
    - When you want to see the actual middle values
2. **PERCENTILE_CONT approach**:
    - When using SQL Server or other databases that support it
    - When you need cleaner, more maintainable code
    - When calculating multiple percentiles

Both methods will give you the same median value when applied correctly to your dataset.