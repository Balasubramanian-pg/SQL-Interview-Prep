Here are comprehensive methods to manage duplicate records in your transaction table:

## 1. Backup Original Table (Always First Step)

```SQL
-- Create backup
SELECT * INTO transaction_backup FROM transaction;

-- Verify backup
SELECT COUNT(*) FROM transaction_backup;
```

## 2. Delete Duplicates (Keeping Earliest Record)

```SQL
-- Method 1: Using GROUP BY and JOIN (SQL Server)
DELETE t
FROM transaction t
INNER JOIN (
    SELECT order_id, MIN(create_time) AS min_create_time
    FROM transaction
    GROUP BY order_id
    HAVING COUNT(*) > 1
) dup ON t.order_id = dup.order_id AND t.create_time = dup.min_create_time;

-- Method 2: Using ROW_NUMBER() (More comprehensive)
WITH duplicates AS (
    SELECT *,
           ROW_NUMBER() OVER(PARTITION BY order_id ORDER BY create_time) AS rn
    FROM transaction
)
DELETE FROM transaction
WHERE (order_id, create_time) IN (
    SELECT order_id, create_time
    FROM duplicates
    WHERE rn > 1
);
```

## 3. Remove All Duplicates (Keeping Only Distinct Records)

```SQL
-- Step 1: Backup current data
SELECT * INTO transaction_temp FROM transaction;

-- Step 2: Truncate original table
TRUNCATE TABLE transaction;

-- Step 3: Reinsert distinct records
INSERT INTO transaction
SELECT DISTINCT * FROM transaction_temp;

-- Step 4: Cleanup
DROP TABLE transaction_temp;
```

## 4. Alternative: Create New Table with Distinct Records

```SQL
-- Create new table with only distinct records
SELECT DISTINCT * INTO transaction_distinct FROM transaction;

-- Verify counts
SELECT COUNT(*) FROM transaction;
SELECT COUNT(*) FROM transaction_distinct;

-- If satisfied, rename tables (after backing up)
EXEC sp_rename 'transaction', 'transaction_old';
EXEC sp_rename 'transaction_distinct', 'transaction';
```

## Important Notes:

1. **Always backup** your data before performing delete operations
2. **Transaction control** is recommended:
    
    ```SQL
    BEGIN TRANSACTION;
    -- Your delete/insert statements here
    -- Verify results before committing
    SELECT * FROM transaction WHERE order_id IN (1,2,3);
    -- If correct:
    COMMIT TRANSACTION;
    -- If incorrect:
    ROLLBACK TRANSACTION;
    ```
    
3. **For complex duplicates** (based on multiple columns):
    
    ```SQL
    WITH duplicates AS (
        SELECT *,
               ROW_NUMBER() OVER(
                   PARTITION BY order_id, product_name, order_amount
                   ORDER BY create_time DESC
               ) AS rn
        FROM transaction
    )
    DELETE FROM transaction
    WHERE (order_id, create_time) IN (
        SELECT order_id, create_time
        FROM duplicates
        WHERE rn > 1
    );
    ```
    
4. **Prevention is better than cure** - consider adding constraints:
    
    ```SQL
    ALTER TABLE transaction ADD CONSTRAINT UQ_Transaction_OrderID UNIQUE (order_id);
    -- Or for multi-column uniqueness:
    ALTER TABLE transaction ADD CONSTRAINT UQ_Transaction_Composite UNIQUE (order_id, product_name);
    ```
    

Choose the method that best fits your specific duplicate scenario and database constraints.