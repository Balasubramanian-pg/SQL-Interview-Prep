Here's a comprehensive solution for finding products frequently bought together:

## Complete Solution

```SQL
-- Step 1: Find all product pairs purchased together in the same order
WITH product_pairs AS (
    SELECT
        o1.product_id AS product1,
        o2.product_id AS product2,
        COUNT(*) AS purchase_frequency
    FROM orderss o1
    INNER JOIN orderss o2 ON o1.order_id = o2.order_id
    WHERE o1.product_id < o2.product_id  -- Avoid duplicates (A+B vs B+A)
    GROUP BY o1.product_id, o2.product_id
)

-- Step 2: Join with product names and format results
SELECT
    p1.name AS product1,
    p2.name AS product2,
    pp.purchase_frequency,
    CONCAT(p1.name, ' + ', p2.name) AS product_pair,
    RANK() OVER(ORDER BY pp.purchase_frequency DESC) AS popularity_rank
FROM product_pairs pp
JOIN products p1 ON pp.product1 = p1.id
JOIN products p2 ON pp.product2 = p2.id
ORDER BY pp.purchase_frequency DESC;
```

## Explanation:

1. **Self-Join Technique**:
    - We join the orders table to itself on `order_id` to find products purchased together
    - The condition `o1.product_id < o2.product_id` ensures each pair is counted only once (A+B but not B+A)
2. **Frequency Calculation**:
    - We count how many times each product pair appears together in orders
    - This gives us the "purchase frequency" metric
3. **Product Name Lookup**:
    - We join with the products table twice to get names for both products in each pair
4. **Result Formatting**:
    - Creates a clean "product_pair" string concatenation
    - Adds a popularity rank based on purchase frequency

## Alternative Version (Simpler Output)

```SQL
SELECT
    p1.name AS product1,
    p2.name AS product2,
    COUNT(*) AS times_bought_together,
    CONCAT('Customers who bought ', p1.name, ' also bought ', p2.name) AS recommendation
FROM orderss o1
JOIN orderss o2 ON o1.order_id = o2.order_id AND o1.product_id < o2.product_id
JOIN products p1 ON o1.product_id = p1.id
JOIN products p2 ON o2.product_id = p2.id
GROUP BY p1.name, p2.name
ORDER BY times_bought_together DESC;
```

## Expected Output:

For the sample data, the results would show:

|   |   |   |   |   |
|---|---|---|---|---|
|product1|product2|purchase_frequency|product_pair|popularity_rank|
|A|B|2|A + B|1|
|A|D|1|A + D|2|
|B|D|1|B + D|2|
|A|C|1|A + C|2|
|B|C|1|B + C|2|

## Business Application:

This analysis helps power recommendation engines by:

1. Identifying which products are frequently purchased together
2. Creating "frequently bought together" suggestions
3. Optimizing product placement and bundling strategies
4. Personalizing marketing campaigns based on purchase patterns

The results can be used to:

- Display recommendations on product pages
- Create targeted email campaigns
- Design promotional bundles
- Optimize warehouse product placement for faster fulfillment
