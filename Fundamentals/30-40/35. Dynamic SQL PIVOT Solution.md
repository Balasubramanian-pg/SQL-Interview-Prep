Here's a complete solution for dynamically pivoting data without hardcoding column names:

```SQL
-- Step 1: Generate the column list dynamically
DECLARE @columns NVARCHAR(MAX);
DECLARE @sql NVARCHAR(MAX);

-- Get distinct column names and format them for PIVOT
SELECT @columns = STRING_AGG(QUOTENAME(Name), ',')
FROM (SELECT DISTINCT Name FROM Dpemp) AS distinct_names;

-- Step 2: Build the dynamic PIVOT query
SET @sql = N'
SELECT
    ID, ' + @columns + '
FROM
(
    SELECT
        ID,
        Name AS e_name,
        Value
    FROM Dpemp
) AS SourceTable
PIVOT
(
    MAX(Value)
    FOR e_name IN (' + @columns + ')
) AS PivotTable;';

-- Step 3: Execute the dynamic SQL
EXEC sp_executesql @sql;
```

## Explanation:

1. **Column List Generation**:
    - `QUOTENAME()` ensures proper formatting of column names (handles spaces/special characters)
    - `STRING_AGG()` concatenates all distinct names with commas
2. **Dynamic SQL Construction**:
    - Builds the complete PIVOT query as a string
    - Inserts the dynamically generated column list in two places:
        - In the SELECT clause
        - In the PIVOT IN clause
3. **Execution**:
    - Uses `sp_executesql` to run the dynamic SQL (safer than EXEC for parameterized queries)

## Expected Output:

|   |   |   |   |
|---|---|---|---|
|ID|Name|Gender|Salary|
|1|Adam|Male|50000|
|2|Mila|FeMale|50000|

## Key Benefits:

1. **Automatic Adaptation**:
    - Works with any attributes in the table (no need to modify code when new attributes are added)
2. **Proper Formatting**:
    - `QUOTENAME()` handles column names with spaces or special characters
3. **Security**:
    - Uses parameterized execution to prevent SQL injection

## Alternative for Older SQL Server Versions (pre-2017):

```SQL
-- For SQL Server versions without STRING_AGG()
DECLARE @columns NVARCHAR(MAX) = '';
DECLARE @sql NVARCHAR(MAX);

SELECT @columns = @columns + QUOTENAME(Name) + ','
FROM (SELECT DISTINCT Name FROM Dpemp) AS distinct_names;

-- Remove trailing comma
SET @columns = LEFT(@columns, LEN(@columns) - 1);

-- Rest of the dynamic SQL remains the same
SET @sql = N'...';
EXEC sp_executesql @sql;
```

This solution will automatically adapt to any new attributes added to the Dpemp table without requiring code changes.
