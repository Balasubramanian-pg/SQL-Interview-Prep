## 8. What are **transactions** and how do **COMMIT** and **ROLLBACK** work?

### **What Are Transactions?**
A **transaction** is a **sequence of one or more SQL operations** executed as a **single unit of work**. Transactions ensure that data remains **consistent** and **reliable**, even in cases of errors or system failures. They follow the **ACID** properties (Atomicity, Consistency, Isolation, Durability).

### **Key Concepts**
1. **Atomicity**: All operations in a transaction **succeed or fail together**. No partial updates.
2. **Consistency**: Transactions bring the database from one valid state to another.
3. **Isolation**: Transactions run independently; intermediate states are invisible to others.
4. **Durability**: Committed transactions persist even after system failures.

---

### **How Transactions Work**
- **Begin**: Start a transaction.
- **Execute**: Run SQL statements (e.g., `INSERT`, `UPDATE`, `DELETE`).
- **Commit**: Save changes permanently.
- **Rollback**: Undo changes if an error occurs.

---

### **COMMIT**
- **Purpose**: Permanently saves all changes made during the transaction.
- **Effect**:
  - All modifications (inserts, updates, deletes) are written to the database.
  - The transaction ends successfully.
- **Example**:
  ```sql
  BEGIN TRANSACTION;
      UPDATE accounts SET balance = balance - 100 WHERE id = 1;
      UPDATE accounts SET balance = balance + 100 WHERE id = 2;
  COMMIT; -- Changes are saved permanently
  ```


### **ROLLBACK**
- **Purpose**: Undoes all changes made during the transaction.
- **Effect**:
  - Reverts the database to its state before the transaction started.
  - Used if an error occurs or if the transaction cannot complete.
- **Example**:
  ```sql
  BEGIN TRANSACTION;
      UPDATE accounts SET balance = balance - 100 WHERE id = 1;
      -- Oops! Insufficient funds
      ROLLBACK; -- Changes are undone
  ```


### **Transaction Flow Example**
```sql
BEGIN TRANSACTION; -- Start transaction

-- Transfer $100 from Account 1 to Account 2
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;

-- Check for errors (e.g., negative balance)
IF (SELECT balance FROM accounts WHERE id = 1) < 0
    ROLLBACK; -- Undo if error
ELSE
    COMMIT; -- Save if successful
```


### **Key Callouts**

<ins>**Callout 1: All or Nothing**</ins>
- **COMMIT**: All changes are saved.
- **ROLLBACK**: All changes are undone.

<ins>**Callout 2: Error Handling**</ins>
- Always use `TRY...CATCH` (SQL Server) or `BEGIN...EXCEPTION` (PL/SQL) to handle errors and trigger rollbacks.

<ins>**Callout 3: Isolation Levels**</ins>
- Transactions can run at different isolation levels (e.g., `READ COMMITTED`, `SERIALIZABLE`), affecting concurrency and performance.

<ins>**Callout 4: Autocommit**</ins>
- Some databases (e.g., MySQL) use **autocommit** by default (each statement is a transaction). Disable it for multi-statement transactions:
  ```sql
  SET autocommit = 0; -- Disable autocommit
  ```

<ins>**Callout 5: Savepoints**</ins>
- Some databases (e.g., Oracle, PostgreSQL) support **savepoints** to roll back part of a transaction:
  ```sql
  SAVEPOINT before_update;
  UPDATE table SET column = value;
  ROLLBACK TO before_update; -- Undo only part of the transaction
  ```

### **When to Use Transactions?**
- **Financial systems**: Bank transfers, payments.
- **Inventory management**: Updating stock levels.
- **Multi-step operations**: Any process requiring atomicity (e.g., booking systems).

**Summary:**
- **Transactions** group operations into a single unit.
- **COMMIT** saves changes permanently.
- **ROLLBACK** undoes changes on failure.
- **ACID** properties ensure reliability.
