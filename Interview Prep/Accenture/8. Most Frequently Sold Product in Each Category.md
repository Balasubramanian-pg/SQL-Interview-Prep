# Most Frequently Sold Product in Each Category Analysis

## Business Value
Identifying category leaders helps businesses:
- Optimize inventory allocation
- Highlight best-performing products
- Inform marketing and promotional strategies
- Identify cross-selling opportunities
- Recognize market trends by category

## Database Schema

```sql
CREATE TABLE Products (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    category_id INT NOT NULL,
    price DECIMAL(10,2)
    -- Additional product attributes
);

CREATE TABLE OrderDetails (
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL,
    PRIMARY KEY (order_id, product_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);
```

## Enhanced SQL Solution

```sql
WITH CategoryProductSales AS (
    SELECT 
        p.category_id,
        p.product_id,
        p.product_name,
        SUM(od.quantity) AS total_units_sold,
        SUM(od.quantity * p.price) AS total_revenue,
        RANK() OVER(
            PARTITION BY p.category_id 
            ORDER BY SUM(od.quantity) DESC
        ) AS sales_rank
    FROM 
        OrderDetails od
    JOIN 
        Products p ON od.product_id = p.product_id
    GROUP BY 
        p.category_id, p.product_id, p.product_name
)
SELECT 
    c.name AS category_name,
    cp.product_name,
    cp.total_units_sold,
    cp.total_revenue,
    ROUND(cp.total_revenue / cp.total_units_sold, 2) AS avg_price_per_unit
FROM 
    CategoryProductSales cp
JOIN 
    Categories c ON cp.category_id = c.category_id
WHERE 
    cp.sales_rank = 1
ORDER BY 
    cp.total_units_sold DESC;
```

## Key Enhancements

1. **Added Business Metrics**:
   - `total_revenue`: Monetary value of sales (quantity Ã— price)
   - `avg_price_per_unit`: Calculated price point of top products

2. **Improved Readability**:
   - Included product and category names instead of just IDs
   - Used a CTE for better query structure

3. **Additional Sorting**:
   - Ordered results by sales volume (highest first)

4. **Assumed Categories Table**:
   - Added join to a Categories table for proper naming

## Sample Results

| category_name | product_name    | total_units_sold | total_revenue | avg_price_per_unit |
|---------------|-----------------|------------------|---------------|--------------------|
| Electronics   | Wireless Earbuds | 1,250           | 62,500.00     | 50.00              |
| Grocery       | Organic Coffee   | 980             | 19,600.00     | 20.00              |
| Clothing      | Cotton T-Shirt   | 750             | 11,250.00     | 15.00              |

## Alternative Approaches

1. **Using DENSE_RANK()** (to handle ties differently):
```sql
RANK() -- Leaves gaps in ranking sequence (1,2,2,4)
DENSE_RANK() -- No gaps in ranking (1,2,2,3)
```

2. **Top N Products Per Category**:
```sql
WHERE sales_rank <= 3  -- Get top 3 products per category
```

3. **With Percentage of Category Sales**:
```sql
SELECT 
    category_id,
    product_id,
    total_units_sold,
    total_units_sold * 100.0 / SUM(total_units_sold) OVER(PARTITION BY category_id) AS category_percentage
FROM CategoryProductSales
WHERE sales_rank = 1;
```

## Performance Optimization

1. **Indexing Strategy**:
```sql
CREATE INDEX idx_orderdetails_product ON OrderDetails(product_id);
CREATE INDEX idx_products_category ON Products(category_id);
```

2. **Materialized View** (for frequently run reports):
```sql
CREATE MATERIALIZED VIEW mv_category_leaders AS
-- Our main query here
WITH REFRESH EVERY 1 DAY;
```

## Business Applications

1. **Inventory Management**:
   - Prioritize stock replenishment for category leaders
   - Identify products that may need increased warehouse space

2. **Marketing Strategy**:
   - Feature top products in promotional campaigns
   - Bundle category leaders with complementary products

3. **Pricing Analysis**:
   - Compare price points of top sellers across categories
   - Identify opportunities for premium versions

4. **Supplier Negotiations**:
   - Leverage sales data for better terms with suppliers
   - Forecast demand more accurately

## Extended Analysis

1. **Seasonal Variations**:
```sql
SELECT 
    p.category_id,
    p.product_id,
    DATEPART(QUARTER, o.order_date) AS quarter,
    SUM(od.quantity) AS quarterly_sales
FROM OrderDetails od
JOIN Products p ON od.product_id = p.product_id
JOIN Orders o ON od.order_id = o.order_id
GROUP BY p.category_id, p.product_id, DATEPART(QUARTER, o.order_date)
ORDER BY p.category_id, quarter, quarterly_sales DESC;
```

2. **Category Leader Trends**:
```sql
WITH MonthlyLeaders AS (
    SELECT 
        p.category_id,
        p.product_id,
        DATE_TRUNC('month', o.order_date) AS month,
        SUM(od.quantity) AS monthly_sales,
        RANK() OVER(PARTITION BY p.category_id, DATE_TRUNC('month', o.order_date) 
            ORDER BY SUM(od.quantity) DESC) AS rank
    FROM OrderDetails od
    JOIN Products p ON od.product_id = p.product_id
    JOIN Orders o ON od.order_id = o.order_id
    GROUP BY p.category_id, p.product_id, DATE_TRUNC('month', o.order_date)
)
SELECT * FROM MonthlyLeaders WHERE rank = 1;
```

3. **New vs. Established Leaders**:
```sql
SELECT 
    cl1.category_id,
    cl1.product_id AS current_leader,
    cl2.product_id AS previous_leader,
    CASE WHEN cl1.product_id = cl2.product_id THEN 'Stable' ELSE 'Changed' END AS status
FROM 
    (SELECT category_id, product_id FROM CategoryLeaders WHERE year = 2023) cl1
LEFT JOIN 
    (SELECT category_id, product_id FROM CategoryLeaders WHERE year = 2022) cl2
    ON cl1.category_id = cl2.category_id;
```
