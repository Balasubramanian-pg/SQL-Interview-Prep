# First and Last Purchase Date Analysis for Customers

## Business Value
Understanding customer purchase timelines helps businesses:
- Identify new vs. established customers
- Measure customer retention and engagement
- Detect inactive customers for re-engagement campaigns
- Analyze purchasing patterns and lifecycle stages

## Database Schema
```sql
CREATE TABLE Orders (
    order_id INT PRIMARY KEY,
    customer_id INT NOT NULL,
    order_date DATE NOT NULL,
    amount DECIMAL(10,2)
    -- Additional order attributes as needed
);
```

## SQL Solution with Enhancements

```sql
SELECT 
    customer_id,
    MIN(order_date) AS first_purchase_date,
    MAX(order_date) AS most_recent_purchase_date,
    COUNT(*) AS total_orders,
    SUM(amount) AS total_spend,
    DATEDIFF(DAY, MIN(order_date), MAX(order_date)) AS customer_tenure_days,
    CASE 
        WHEN MAX(order_date) >= CURRENT_DATE - INTERVAL '90 days' THEN 'Active'
        ELSE 'Inactive' 
    END AS customer_status
FROM 
    Orders
GROUP BY 
    customer_id
ORDER BY 
    most_recent_purchase_date DESC;
```

## Key Enhancements Over Basic Solution

1. **Added Business Metrics**:
   - `total_orders`: Count of all purchases per customer
   - `total_spend`: Aggregate monetary value of all orders
   - `customer_tenure_days`: Days between first and last purchase

2. **Customer Status Classification**:
   - Labels customers as 'Active' (purchased in last 90 days) or 'Inactive'

3. **Practical Sorting**:
   - Orders results by most recent purchase date (newest first)

## Sample Results

| customer_id | first_purchase_date | most_recent_purchase_date | total_orders | total_spend | customer_tenure_days | customer_status |
|-------------|---------------------|---------------------------|--------------|-------------|----------------------|-----------------|
| 103         | 2023-01-15          | 2023-06-20                | 12           | 1450.00     | 156                  | Active          |
| 101         | 2022-11-05          | 2023-06-18                | 8            | 890.50      | 225                  | Active          |
| 105         | 2023-03-10          | 2023-06-15                | 5            | 420.00      | 97                   | Active          |
| 102         | 2021-08-22          | 2023-02-28                | 23           | 3100.75     | 555                  | Inactive        |

## Advanced Analysis Options

1. **Customer Cohort Analysis**:
```sql
SELECT
    YEAR(first_purchase_date) AS cohort_year,
    MONTH(first_purchase_date) AS cohort_month,
    COUNT(*) AS customers,
    AVG(total_orders) AS avg_orders,
    AVG(total_spend) AS avg_spend
FROM (
    -- Our base query as a subquery
    SELECT customer_id, MIN(order_date) AS first_purchase_date,
           COUNT(*) AS total_orders, SUM(amount) AS total_spend
    FROM Orders
    GROUP BY customer_id
) AS customer_stats
GROUP BY YEAR(first_purchase_date), MONTH(first_purchase_date)
ORDER BY cohort_year, cohort_month;
```

2. **Days Since Last Purchase Analysis**:
```sql
SELECT
    customer_id,
    first_purchase_date,
    most_recent_purchase_date,
    DATEDIFF(DAY, most_recent_purchase_date, CURRENT_DATE) AS days_since_last_purchase,
    CASE
        WHEN DATEDIFF(DAY, most_recent_purchase_date, CURRENT_DATE) <= 30 THEN 'High Value'
        WHEN DATEDIFF(DAY, most_recent_purchase_date, CURRENT_DATE) <= 90 THEN 'Medium Value'
        ELSE 'At Risk'
    END AS customer_segment
FROM (
    SELECT 
        customer_id,
        MIN(order_date) AS first_purchase_date,
        MAX(order_date) AS most_recent_purchase_date
    FROM Orders
    GROUP BY customer_id
) AS customer_dates;
```

## Performance Considerations

1. **Optimal Indexing**:
```sql
CREATE INDEX idx_orders_customer_date ON Orders(customer_id, order_date);
CREATE INDEX idx_orders_date ON Orders(order_date);
```

2. **Partitioning Strategy** (for very large datasets):
   - Consider partitioning by order date ranges for time-series analysis

## Business Applications

1. **Customer Retention Programs**:
   - Target customers approaching inactivity thresholds
   - Reactivation campaigns for lapsed customers

2. **Loyalty Program Design**:
   - Tier customers based on purchase frequency and recency
   - Customize rewards for different customer segments

3. **Inventory Planning**:
   - Anticipate demand from regular customers
   - Identify seasonal purchasing patterns

4. **Customer Lifetime Value Prediction**:
   - Combine with other metrics to predict future value
   - Identify high-potential customers early in lifecycle
