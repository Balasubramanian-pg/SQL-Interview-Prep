# *7. Whatâ€™s the difference between a correlated subquery and a non-correlated subquery?*
## Correlated vs Non-Correlated Subquery

*   **Non-Correlated Subquery**
> [!TIP]
> Executes first, independently of the outer query.
*   Can run completely on its own.
*   Executes **once** before the main query.
*   Returns a result that the outer query then uses.
*   Also called a "simple subquery."

*   **Correlated Subquery**
> [!IMPORTANT]
> Executes once for every row processed by the outer query.
*   **Cannot** run independently - it references columns from the outer query.
*   Executes **repeatedly**, once for each candidate row.
*   The outer query's row value changes with each execution.
*   Generally slower due to repeated executions.

**Execution Process**

*   **Non-Correlated Execution**
> [!NOTE]
> Think of it as a two-step process where the inner query provides a static list or value.
1.  Database executes the inner query completely.
2.  Database executes the outer query using the inner query's result.
*   Example: "Find employees who earn more than the company average."

*   **Correlated Execution**
> [!CAUTION]
> Think of it as a nested loop where the inner query runs for each outer row.
1.  Database gets a row from the outer query.
2.  Database executes the inner query using values from that specific outer row.
3.  Database uses the inner query's result to decide whether to include the outer row.
4.  Repeats for every row in the outer query.
*   Example: "Find employees who earn more than the average of their own department."

**SQL Examples**

*   **Non-Correlated Example**
```sql
-- Find all employees earning more than average salary
SELECT EmployeeName, Salary
FROM Employees
WHERE Salary > (SELECT AVG(Salary) FROM Employees);
-- Inner query runs once, returns a single number
```

*   **Correlated Example**
```sql
-- Find employees who earn more than their department's average
SELECT e1.EmployeeName, e1.Salary, e1.Department
FROM Employees e1
WHERE Salary > (
    SELECT AVG(Salary)
    FROM Employees e2
    WHERE e2.Department = e1.Department  -- References outer query
);
-- Inner query runs for each employee, using their department
```

**Performance Impact**

*   **Non-Correlated**
*   Typically better performance.
*   Executes only once.
*   Can often be rewritten as a JOIN.

*   **Correlated**
> [!CAUTION]
> Can be slow with large datasets due to repeated executions.
*   Executes once per row in outer query.
*   Sometimes necessary for complex business logic.
*   Consider using JOINs or window functions as alternatives.

**When to Use Each**

*   **Use Non-Correlated For:**
*   Simple comparisons against aggregated values.
*   Checking membership in a static list.
*   Situations where the inner result doesn't depend on outer row.

*   **Use Correlated For:**
*   Row-by-row comparisons against related aggregates.
*   When you need to compare each row to its "group" average/max/min.
*   Complex business rules that require per-row calculation.
